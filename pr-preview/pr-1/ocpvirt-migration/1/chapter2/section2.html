<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Add a VMware vSphere source provider and connect to VMware provider :: Migrate VMs from VMware vSphere to Red Hat OpenShift Virtualization</title>
    <link rel="prev" href="section1.html">
    <link rel="next" href="section3.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Migrate VMs from VMware vSphere to Red Hat OpenShift Virtualization</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/ocpvirt-migration/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ocpvirt-migration" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Migrate VMs from VMware vSphere to Red Hat OpenShift Virtualization</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Introduction to Operator Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section1.html">Install OpenShift Virtualization Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section2.html">Install Migration Toolkit Virtualization Operator</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Migrate VMs from VMware vSphere to OpenShift Virtualization</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section1.html">The VMware environment</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section2.html">Add a VMware vSphere source provider and connect to VMware provider</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">The Migration Plan</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section4.html">Review and configure migrated Virtual Machines</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Migrate VMs from VMware vSphere to Red Hat OpenShift Virtualization</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Migrate VMs from VMware vSphere to Red Hat OpenShift Virtualization</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Migrate VMs from VMware vSphere to Red Hat OpenShift Virtualization</a></li>
    <li><a href="index.html">Migrate VMs from VMware vSphere to OpenShift Virtualization</a></li>
    <li><a href="section2.html">Add a VMware vSphere source provider and connect to VMware provider</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Add a VMware vSphere source provider and connect to VMware provider</h1>
<div class="sect1">
<h2 id="_prerequisites_for_the_vmware_provider"><a class="anchor" href="#_prerequisites_for_the_vmware_provider"></a>Prerequisites for the VMware Provider</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following prerequisites apply to all migrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ISO/CD-ROM disks must be unmounted.</p>
</li>
<li>
<p>Each NIC must contain one IPv4 and/or one IPv6 address.</p>
</li>
<li>
<p>The VM operating system must be certified and supported for use as a <a href="https://access.redhat.com/articles/973163#ocpvirt">guest operating system with OpenShift Virtualization</a>.</p>
</li>
<li>
<p>VM names must contain only lowercase letters (a-z), numbers (0-9), or hyphens (-), up to a maximum of 253 characters. The first and last characters must be alphanumeric. The name must not contain uppercase letters, spaces, periods (.), or special characters.</p>
</li>
<li>
<p>VM names must not duplicate the name of an existing VM in the OpenShift Virtualization environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>Migration Toolkit for Virtualization</strong> will automatically assign a new name to a VM that does not comply with the rules. If this happens, MTV will automatically generate a new VM name to allow the migration to proceed smoothly.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_the_vmware_provider_to_the_migration_toolkit"><a class="anchor" href="#_create_the_vmware_provider_to_the_migration_toolkit"></a>Create the VMware provider to the migration toolkit</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>Migration Toolkit for Virtualization</strong> (<strong>MTV</strong>) uses the VMware Virtual Disk Development Kit (<strong>VDDK</strong>) SDK to transfer virtual disks from VMware vSphere.</p>
</div>
<div class="paragraph">
<p>You must download the <strong>VMware Virtual Disk Development Kit</strong> (<strong>VDDK</strong>), build a VDDK image, and push the VDDK image to your image registry. You need the VDDK init image path in order to add a VMware source provider.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Storing the VDDK image in a public registry might violate the VMware license terms.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you want to configure in your lab then you can create ImageStreams and BuildConfigs.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_create_namespace_for_migration"><a class="anchor" href="#_create_namespace_for_migration"></a>Create namespace for migration</h3>
<div class="paragraph">
<p>Create project called <code>vmexamples</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_imagestreams_and_buildconfigs"><a class="anchor" href="#_create_imagestreams_and_buildconfigs"></a>Create ImageStreams and BuildConfigs</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to <strong>Builds</strong> &#8594; <strong>ImageStreams</strong></p>
</li>
<li>
<p>Press <strong>Create ImageStream</strong></p>
<div class="imageblock">
<div class="content">
<img src="_images/MTV/38_Create_IS.png" alt="38 Create IS">
</div>
</div>
</li>
<li>
<p>Replace the YAML content with the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: image.openshift.io/v1
kind: ImageStream
metadata:
  name: vddk
  namespace: vmexamples</code></pre>
</div>
</div>
</li>
<li>
<p>Navigate to <strong>Builds</strong> &#8594; <strong>BuildConfigs</strong></p>
</li>
<li>
<p>Press <strong>Create BuildConfig</strong> and select the <strong>YAML view</strong> radio button at the top.</p>
<div class="imageblock">
<div class="content">
<img src="_images/MTV/40_Create_BC.png" alt="40 Create BC">
</div>
</div>
</li>
<li>
<p>Replace the YAML content with the following code</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: BuildConfig
apiVersion: build.openshift.io/v1
metadata:
  name: vddk-build
  namespace: vmexamples
spec:
  output:
    to:
      kind: ImageStreamTag
      name: 'vddk:latest'
  strategy:
    type: Docker
    dockerStrategy:
      from:
        kind: ImageStreamTag
        namespace: openshift
        name: 'tools:latest'
  source:
    type: Dockerfile
    dockerfile: |
      FROM registry.access.redhat.com/ubi8/ubi-minimal
      RUN curl -L -O www.opentlc.com/download/ocp4_baremetal/VMware-vix-disklib-7.0.3-20134304.x86_64.tar.gz
      RUN tar -xzf VMware-vix-disklib-7.0.3-20134304.x86_64.tar.gz
      RUN mkdir -p /opt
      ENTRYPOINT ["cp", "-r", "/vmware-vix-disklib-distrib", "/opt"]
  triggers:
    - type: ImageChange
      imageChange: {}
    - type: ConfigChange</code></pre>
</div>
</div>
</li>
<li>
<p>Navigate to <strong>Builds</strong> &#8594; <strong>Builds</strong> and wait until the build status is <strong>Complete</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_add_vmware_provider"><a class="anchor" href="#_add_vmware_provider"></a>Add VMWare Provider</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this demo lab, VMware provider is already added.
If you are performing this on your own setup then you can follow the below instructions to add VMware provider.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate in the left menu to <strong>Migration</strong> &#8594; <strong>Providers for virtualization</strong></p>
</li>
<li>
<p>Select project <code>openshift-mtv</code></p>
</li>
<li>
<p>By default, there is a provider called <code>host</code> which represents the <strong>OpenShift Virtualization</strong> as a target platform</p>
<div class="imageblock">
<div class="content">
<img src="_images/MTV/92_MTV_Provider_list.png" alt="92 MTV Provider list">
</div>
</div>
<div class="paragraph">
<p>However, you will need to register the source vCenter system to the Migration Toolkit for Virtualization as a new provider.</p>
</div>
</li>
<li>
<p>Press <strong>Create Provider</strong> button in the top right. A dialog box will appear.</p>
<div class="imageblock">
<div class="content">
<img src="_images/MTV/93_MTV_Create_Provider.png" alt="93 MTV Create Provider">
</div>
</div>
</li>
<li>
<p>Select <strong>VMware</strong> on the <strong>Provider type</strong> dropdown and fill the following data:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Name</strong>: <code>vmware</code></p>
</li>
<li>
<p><strong>vCenter host name or IP address</strong>: <code>portal.vc.opentlc.com</code></p>
</li>
<li>
<p><strong>vCenter user name</strong>: <code>vcenter_user</code></p>
</li>
<li>
<p><strong>vCenter password</strong>: <code>vcenter_password</code></p>
</li>
<li>
<p><strong>VDDK init image</strong>: <code>image-registry.openshift-image-registry.svc:5000/openshift/vddk:latest</code></p>
</li>
<li>
<p><strong>SHA-1 fingerprint</strong>: <code>C7:BF:C2:DD:CD:73:1C:22:DC:D1:5A:DD:EA:64:21:C1:97:FB:F0:9C</code></p>
<div class="imageblock">
<div class="content">
<img src="_images/MTV/94_MTV_Fill_Dialog.png" alt="94 MTV Fill Dialog">
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Press <strong>Create</strong> and wait till the <strong>Status</strong> column is changed to <code>Ready</code></p>
<div class="imageblock">
<div class="content">
<img src="_images/MTV/95_MTV_Provider_Added.png" alt="95 MTV Provider Added">
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now MTV knows about your VMware vSphere environment and can connect to it.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="section1.html">The VMware environment</a></span>
  <span class="next"><a href="section3.html">The Migration Plan</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
