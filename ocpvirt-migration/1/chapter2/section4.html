<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Review and configure migrated Virtual Machines :: Migrate VMs from VMware vSphere to Red Hat OpenShift Virtualization</title>
    <link rel="prev" href="section3.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Migrate VMs from VMware vSphere to Red Hat OpenShift Virtualization</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/ocpvirt-migration/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ocpvirt-migration" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Migrate VMs from VMware vSphere to Red Hat OpenShift Virtualization</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Introduction to Operator Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section1.html">Install OpenShift Virtualization Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section2.html">Install Migration Toolkit Virtualization Operator</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Migrate VMs from VMware vSphere to OpenShift Virtualization</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section1.html">The VMware environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">Add a VMware vSphere source provider and connect to VMware provider</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">The Migration Plan</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section4.html">Review and configure migrated Virtual Machines</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Migrate VMs from VMware vSphere to Red Hat OpenShift Virtualization</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Migrate VMs from VMware vSphere to Red Hat OpenShift Virtualization</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Migrate VMs from VMware vSphere to Red Hat OpenShift Virtualization</a></li>
    <li><a href="index.html">Migrate VMs from VMware vSphere to OpenShift Virtualization</a></li>
    <li><a href="section4.html">Review and configure migrated Virtual Machines</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Review and configure migrated Virtual Machines</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Your VMs have now been migrated and can be started on OpenShift Virtualization. You could connect to the VM consoles and interact with them as you would in VMware vCenter.</p>
</div>
<div class="paragraph">
<p>However, the VMs are not connected to each other yet - this is because we connected the VMs to the SDN, which works a little bit differently than the external network the VMs were previously connected to.</p>
</div>
<div class="paragraph">
<p>A load balancer on OpenShift is called a <strong>Service</strong>. You will create this shortly. But the service selects the recipients of the traffic that it load balances via labels assigned to the targets. Currently, the VMs do not have a label assigned yet.</p>
</div>
<div class="paragraph">
<p>In order to successfully associate the  VMs with the Service, we need to do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a label to the VMs. We will use the same label for both Windows IIS servers because they are both behind the same load balancer.</p>
</li>
<li>
<p>Create the service to make the two Windows IIS servers available for other workloads on the cluster. OpenShift will automatically make the load balancer internally accessible using the name of the Service as the DNS name.</p>
</li>
<li>
<p>Make the service available outside of OpenShift by creating a <strong>Route</strong>.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the OpenShift console, navigate to <strong>Virtualization</strong> &#8594; <strong>VirtualMachines</strong> and ensure the migrated VMs successfully imported and are running.</p>
<div class="imageblock">
<div class="content">
<img src="_images/MTV/60_VMWARE_VMs_List.png" alt="60 VMWARE VMs List">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that you select the project <code>vmexamples</code></p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Access to the <code>winweb01</code> and navigate to the <strong>YAML</strong> tab.</p>
</li>
<li>
<p>Find the <code>spec:</code> section and under the <code>template.metadata</code> add the following lines to label the VM resources:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">      labels:
        env: webapp</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure to get the indentation exactly right - just like in the screenshot below.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/MTV/61_VMWARE_VMs_YAML.png" alt="61 VMWARE VMs YAML">
</div>
</div>
</li>
<li>
<p><strong>Repeat</strong> the process for the VM <code>winweb02</code>.</p>
</li>
<li>
<p>Start the <em>Virtual Machines</em> <code>database</code>, <code>winweb01</code> and <code>winweb02</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ensure the VMs are properly working by accessing to the console tab of each VM.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Navigate to <strong>Networking</strong> &#8594; <strong>Services</strong> and press <strong>Create Service</strong>. Remember the label that you added to your VMs (<code>env=webapp</code>)? Here you see that the Service uses that label in its selector to pick which VMs to route traffic to.</p>
</li>
<li>
<p>Replace the YAML with the following definition</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Service
metadata:
  name: webapp
  namespace: vmexamples
spec:
  selector:
    env: webapp
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80</code></pre>
</div>
</div>
</li>
<li>
<p>Press <strong>Create</strong>.</p>
</li>
<li>
<p>Now the Windows IIS are accessible from within the OpenShift cluster. Other virtual machines are able to access them using the DNS name <code>webapp.vmexamples</code>. However, since these web servers are the front end to an externally accessible application, we will expose them using a <strong>Route</strong>.</p>
<div class="paragraph">
<p>Navigate to <strong>Networking</strong> &#8594; <strong>Routes</strong> in the left navigation menu. Press <strong>Create Route</strong> and fill the following information:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Name</strong>: <code>route-webapp</code></p>
</li>
<li>
<p><strong>Service</strong>: <code>webapp</code></p>
</li>
<li>
<p><strong>Target port</strong>: <code>80 &#8594; 80 (TCP)</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Press <strong>Create</strong></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift can automatically (re)encrypt traffic entering the cluster via a Route, however, we don&#8217;t need to use TLS for this application. The <strong>Secure Route</strong> option should not be checked.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/MTV/63_VMWARE_VMs_Create_Route.png" alt="63 VMWARE VMs Create Route">
</div>
</div>
</li>
<li>
<p>Navigate to the address shown in <strong>Location</strong> field</p>
<div class="imageblock">
<div class="content">
<img src="_images/MTV/64_VMWARE_VMs_URL.png" alt="64 VMWARE VMs URL">
</div>
</div>
</li>
<li>
<p>When the page loads, you will see an error. This is because the Windows web servers are not able to resolve the internal name <code>database</code> to connect to the database VM.</p>
<div class="paragraph">
<p>To fix the connectivity issue, we need to create another Service for the database VM so that it is discoverable by other VMs connected to the SDN. Note that because this database does <strong>not</strong> need to be accessible from outside of the OpenShift environment, you do not need to create a route for this service.</p>
</div>
<div class="paragraph">
<p>Navigate to <strong>Networking</strong> &#8594; <strong>Services</strong> and press <strong>Create service</strong>. Replace the YAML with the following definition</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Service
metadata:
  name: database
  namespace: vmexamples
spec:
  selector:
    vm.kubevirt.io/name: database
  ports:
    - protocol: TCP
      port: 3306
      targetPort: 3306</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In this example the service is simply using a selector of the VM&#8217;s name. This is a default label that is automatically added to all VMs. Since there is only one VM that matches the selector, the service will not load balance to the database, instead we&#8217;re using the Service for discovery via the internal DNS name.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Reload the webapp URL and expect to get the proper result</p>
<div class="imageblock">
<div class="content">
<img src="_images/MTV/65_VMWARE_VMs_URL.png" alt="65 VMWARE VMs URL">
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to the Migration Toolkit for Virtualization, there are three other migration toolkits. The combination of these can be used to move many workloads into and within OpenShift clusters depending on your organization&#8217;s needs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://developers.redhat.com/products/mtr/overview">Migration Toolkit for Runtimes</a> - Assist and accelerate Java application modernization and migration.</p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/migration_toolkit_for_applications/">Migration Toolkit for Applications</a> - Accelerate large-scale application modernization efforts to containers and Kubernetes.</p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.12/migration_toolkit_for_containers/about-mtc.html">Migration Toolkit for Containers</a> - Migrate stateful application workloads between OpenShift clusters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about these, please reach out to your Red Hat account team.</p>
</div>
<div class="paragraph">
<p>In this module, you explored how to migrate virtual machines from VMware vSphere to Red Hat OpenShift Virtualization. You have migrated a web application containing two Windows systems and a Linux system. You used OpenShift features to provide networking access to the application, and you learned to create services to provide internal access in the project.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="section3.html">The Migration Plan</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
